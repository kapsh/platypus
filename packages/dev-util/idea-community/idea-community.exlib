# Copyright 2018 Alexander Kapshuna
# Distributed under the terms of the GNU General Public License v2

export_exlib_phases pkg_setup src_install

SUMMARY="Java IDE for Professional Developers"
HOMEPAGE="https://www.jetbrains.com/idea/"
DOWNLOADS="https://download-cf.jetbrains.com/idea/ideaIC-${PV}-no-jdk.tar.gz"

LICENCES="Apache-2.0"
SLOT="0"
MYOPTIONS=""

DEPENDENCIES="
    build:
    build+run:
        suggestion:
            dev-java/intellij-jdk
"

_EXECUTABLES=(
    format.sh
    fsnotifier
    fsnotifier-arm
    fsnotifier64
    inspect.sh
    printenv.py
    idea.sh
    restart.py
)

_BUILD="181.4668.68"
PRODUCT="idea-IC"
WORK="${WORKBASE}/${PRODUCT}-${_BUILD}"

idea-community_pkg_setup() {
    exdirectory --allow /opt
}

idea-community_src_install() {
    local dest="/opt/${PN}"
    dodir "${dest}"

    insinto "${dest}"
    doins -r *

    for exe in "${_EXECUTABLES[@]}"; do
        edo chmod a+x "${IMAGE}/${dest}/bin/$exe"
    done

    dodir "/usr/$(exhost --target)/bin"
    dosym "${dest}/bin/idea.sh" "/usr/$(exhost --target)/bin/${PN}"

    insinto "/usr/share/icons/hicolor/128x128/apps"
    newins "${dest}/bin/idea.png" "${PN}.png"

    insinto "/usr/share/applications"
    doins "${FILES}/jetbrains-idea-ce.desktop"
}

